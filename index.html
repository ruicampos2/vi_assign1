<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>World Map - Data Visualization</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://d3js.org/topojson.v1.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; }
    .country { stroke: #333; stroke-width: 0.5px; }
    .active { fill: #ffcc00; }
    #info { position: absolute; left: 20px; top: 20px; background-color: #f9f9f9; padding: 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <div id="info">
    <h2>Country Information</h2>
    <div id="details">Click on a country to see data.</div>
  </div>

  <script>
    var width = 1200, height = 800;

    // Ajustando a escala e tradução da projeção para centralizar o mapa
    var projection = d3.geoMercator()
      .scale(150) // Aumenta a escala do mapa
      .translate([width / 2, height / 1.5]); // Ajusta a posição do mapa mais centralizado

    var path = d3.geoPath().projection(projection);

    var svg = d3.select("body").append("svg")
      .attr("width", width)
      .attr("height", height);

    // Definir um esquema de cores para os países com base na taxa de obesidade
    var colorScale = d3.scaleQuantize()
      .domain([0, 50]) // Define o intervalo de dados, como taxas de obesidade
      .range(d3.schemeBlues[9]); // Usa um esquema de cores com 9 tons de azul

    // Carrega o mapa e os dados do CSV
    Promise.all([
      d3.json("https://d3js.org/world-110m.v1.json"),  // Mapa mundial
      d3.csv("dataset/dataset.csv")               // CSV com os dados
    ]).then(function([worldData, csvData]) {

      // Verifica se os dados CSV estão carregando corretamente
      console.log("CSV Data Loaded: ", csvData);
      
      var countries = topojson.feature(worldData, worldData.objects.countries).features;

      // Cria um dicionário com base no CSV
      var dataByCountry = {};
      csvData.forEach(function(d) {
        dataByCountry[d.Country] = d;
      });

      console.log("Data By Country: ", dataByCountry); // Depuração para garantir que os dados estejam corretos

      // Desenha o mapa e adiciona cores com base na taxa de obesidade
      svg.selectAll("path")
        .data(countries)
        .enter().append("path")
        .attr("class", "country")
        .attr("d", path)
        .attr("fill", function(d) {
          var countryData = dataByCountry[d.properties.name];
          return countryData ? colorScale(countryData['Obesity Rate (%)']) : "#ccc"; // Aplica a cor ou cinza se não houver dados
        })
        .on("click", function(event, d) {
          var countryName = d.properties.name;
          var countryData = dataByCountry[countryName];
          console.log("Clicked Country: ", countryName);  // Verifica qual país foi clicado

          if (countryData) {
            d3.select("#details").html(`
              <h3>${countryName}</h3>
              <p>Obesity Rate: ${countryData['Obesity Rate (%)']}%</p>
              <p>Football Participation: ${countryData['% Football']}%</p>
              <p>Basketball Participation: ${countryData['% Basketball']}%</p>
              <p>Running Participation: ${countryData['% Running']}%</p>
            `);
          } else {
            d3.select("#details").html(`<p>No data available for ${countryName}</p>`);
          }
        });
    }).catch(function(error) {
      console.error("Erro ao carregar os dados: ", error);
    });
  </script>
</body>
</html>
